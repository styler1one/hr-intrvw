<!DOCTYPE html>
<html>
<head>
    <title>WebSocket Test</title>
</head>
<body>
    <h1>WebSocket Test</h1>
    <button onclick="test()">Send Test Message</button>
    <div id="output"></div>

    <script>
        let ws = null;
        let sessionId = null;

        async function test() {
            const output = document.getElementById('output');
            output.innerHTML += '<p>Starting test...</p>';

            // Create session
            const response = await fetch('http://localhost:8000/api/session/start', {
                method: 'POST'
            });
            const data = await response.json();
            sessionId = data.session_id;
            output.innerHTML += `<p>Session created: ${sessionId}</p>`;

            // Connect WebSocket
            ws = new WebSocket(`ws://localhost:8000/ws/interview/${sessionId}`);
            
            ws.onopen = () => {
                output.innerHTML += '<p>WebSocket connected!</p>';
            };

            ws.onmessage = (event) => {
                const data = JSON.parse(event.data);
                output.innerHTML += `<p>Received: ${JSON.stringify(data)}</p>`;
            };

            ws.onerror = (error) => {
                output.innerHTML += `<p>Error: ${error}</p>`;
            };

            // Wait for connection
            setTimeout(() => {
                if (ws.readyState === 1) {
                    output.innerHTML += '<p>Sending message...</p>';
                    ws.send(JSON.stringify({
                        type: 'user_message',
                        content: 'Test message'
                    }));
                }
            }, 1000);
        }
    </script>
</body>
</html>
